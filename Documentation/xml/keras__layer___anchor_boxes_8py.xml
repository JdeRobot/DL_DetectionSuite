<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.13">
  <compounddef id="keras__layer___anchor_boxes_8py" kind="file" language="Python">
    <compoundname>keras_layer_AnchorBoxes.py</compoundname>
    <innerclass refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes" prot="public">keras_utils::keras_layer_AnchorBoxes::AnchorBoxes</innerclass>
    <innernamespace refid="namespacekeras__utils_1_1keras__layer___anchor_boxes">keras_utils::keras_layer_AnchorBoxes</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacekeras__utils_1_1keras__layer___anchor_boxes" refkind="compound"><highlight class="stringliteral">&apos;&apos;&apos;</highlight></codeline>
<codeline lineno="2"><highlight class="stringliteral">A<sp/>custom<sp/>Keras<sp/>layer<sp/>to<sp/>generate<sp/>anchor<sp/>boxes.</highlight></codeline>
<codeline lineno="3"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="4"><highlight class="stringliteral">Copyright<sp/>(C)<sp/>2017<sp/>Pierluigi<sp/>Ferrari</highlight></codeline>
<codeline lineno="5"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="6"><highlight class="stringliteral">This<sp/>program<sp/>is<sp/>free<sp/>software:<sp/>you<sp/>can<sp/>redistribute<sp/>it<sp/>and/or<sp/>modify</highlight></codeline>
<codeline lineno="7"><highlight class="stringliteral">it<sp/>under<sp/>the<sp/>terms<sp/>of<sp/>the<sp/>GNU<sp/>General<sp/>Public<sp/>License<sp/>as<sp/>published<sp/>by</highlight></codeline>
<codeline lineno="8"><highlight class="stringliteral">the<sp/>Free<sp/>Software<sp/>Foundation,<sp/>either<sp/>version<sp/>3<sp/>of<sp/>the<sp/>License,<sp/>or</highlight></codeline>
<codeline lineno="9"><highlight class="stringliteral">(at<sp/>your<sp/>option)<sp/>any<sp/>later<sp/>version.</highlight></codeline>
<codeline lineno="10"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="11"><highlight class="stringliteral">This<sp/>program<sp/>is<sp/>distributed<sp/>in<sp/>the<sp/>hope<sp/>that<sp/>it<sp/>will<sp/>be<sp/>useful,</highlight></codeline>
<codeline lineno="12"><highlight class="stringliteral">but<sp/>WITHOUT<sp/>ANY<sp/>WARRANTY;<sp/>without<sp/>even<sp/>the<sp/>implied<sp/>warranty<sp/>of</highlight></codeline>
<codeline lineno="13"><highlight class="stringliteral">MERCHANTABILITY<sp/>or<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE.<sp/><sp/>See<sp/>the</highlight></codeline>
<codeline lineno="14"><highlight class="stringliteral">GNU<sp/>General<sp/>Public<sp/>License<sp/>for<sp/>more<sp/>details.</highlight></codeline>
<codeline lineno="15"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="16"><highlight class="stringliteral">You<sp/>should<sp/>have<sp/>received<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>GNU<sp/>General<sp/>Public<sp/>License</highlight></codeline>
<codeline lineno="17"><highlight class="stringliteral">along<sp/>with<sp/>this<sp/>program.<sp/><sp/>If<sp/>not,<sp/>see<sp/>&lt;http://www.gnu.org/licenses/&gt;.</highlight></codeline>
<codeline lineno="18"><highlight class="stringliteral">&apos;&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>__future__<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>division</highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>numpy<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>np</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>keras.backend<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>K</highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>keras.engine.topology<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>InputSpec</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>keras.engine.topology<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Layer</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>bounding_box_utils<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>convert_coordinates</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes" kindref="compound">AnchorBoxes</ref>(Layer):</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&apos;&apos;</highlight></codeline>
<codeline lineno="30"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>A<sp/>Keras<sp/>layer<sp/>to<sp/>create<sp/>an<sp/>output<sp/>tensor<sp/>containing<sp/>anchor<sp/>box<sp/>coordinates</highlight></codeline>
<codeline lineno="31"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>and<sp/>variances<sp/>based<sp/>on<sp/>the<sp/>input<sp/>tensor<sp/>and<sp/>the<sp/>passed<sp/>arguments.</highlight></codeline>
<codeline lineno="32"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="33"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>A<sp/>set<sp/>of<sp/>2D<sp/>anchor<sp/>boxes<sp/>of<sp/>different<sp/>aspect<sp/>ratios<sp/>is<sp/>created<sp/>for<sp/>each<sp/>spatial<sp/>unit<sp/>of</highlight></codeline>
<codeline lineno="34"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>the<sp/>input<sp/>tensor.<sp/>The<sp/>number<sp/>of<sp/>anchor<sp/>boxes<sp/>created<sp/>per<sp/>unit<sp/>depends<sp/>on<sp/>the<sp/>arguments</highlight></codeline>
<codeline lineno="35"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>`aspect_ratios`<sp/>and<sp/>`two_boxes_for_ar1`,<sp/>in<sp/>the<sp/>default<sp/>case<sp/>it<sp/>is<sp/>4.<sp/>The<sp/>boxes</highlight></codeline>
<codeline lineno="36"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>are<sp/>parameterized<sp/>by<sp/>the<sp/>coordinate<sp/>tuple<sp/>`(xmin,<sp/>xmax,<sp/>ymin,<sp/>ymax)`.</highlight></codeline>
<codeline lineno="37"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="38"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>The<sp/>logic<sp/>implemented<sp/>by<sp/>this<sp/>layer<sp/>is<sp/>identical<sp/>to<sp/>the<sp/>logic<sp/>in<sp/>the<sp/>module</highlight></codeline>
<codeline lineno="39"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>`ssd_box_encode_decode_utils.py`.</highlight></codeline>
<codeline lineno="40"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="41"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>The<sp/>purpose<sp/>of<sp/>having<sp/>this<sp/>layer<sp/>in<sp/>the<sp/>network<sp/>is<sp/>to<sp/>make<sp/>the<sp/>model<sp/>self-sufficient</highlight></codeline>
<codeline lineno="42"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>at<sp/>inference<sp/>time.<sp/>Since<sp/>the<sp/>model<sp/>is<sp/>predicting<sp/>offsets<sp/>to<sp/>the<sp/>anchor<sp/>boxes</highlight></codeline>
<codeline lineno="43"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>(rather<sp/>than<sp/>predicting<sp/>absolute<sp/>box<sp/>coordinates<sp/>directly),<sp/>one<sp/>needs<sp/>to<sp/>know<sp/>the<sp/>anchor</highlight></codeline>
<codeline lineno="44"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>box<sp/>coordinates<sp/>in<sp/>order<sp/>to<sp/>construct<sp/>the<sp/>final<sp/>prediction<sp/>boxes<sp/>from<sp/>the<sp/>predicted<sp/>offsets.</highlight></codeline>
<codeline lineno="45"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>If<sp/>the<sp/>model&apos;s<sp/>output<sp/>tensor<sp/>did<sp/>not<sp/>contain<sp/>the<sp/>anchor<sp/>box<sp/>coordinates,<sp/>the<sp/>necessary</highlight></codeline>
<codeline lineno="46"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>information<sp/>to<sp/>convert<sp/>the<sp/>predicted<sp/>offsets<sp/>back<sp/>to<sp/>absolute<sp/>coordinates<sp/>would<sp/>be<sp/>missing</highlight></codeline>
<codeline lineno="47"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>in<sp/>the<sp/>model<sp/>output.<sp/>The<sp/>reason<sp/>why<sp/>it<sp/>is<sp/>necessary<sp/>to<sp/>predict<sp/>offsets<sp/>to<sp/>the<sp/>anchor<sp/>boxes</highlight></codeline>
<codeline lineno="48"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>rather<sp/>than<sp/>to<sp/>predict<sp/>absolute<sp/>box<sp/>coordinates<sp/>directly<sp/>is<sp/>explained<sp/>in<sp/>`README.md`.</highlight></codeline>
<codeline lineno="49"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="50"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Input<sp/>shape:</highlight></codeline>
<codeline lineno="51"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>4D<sp/>tensor<sp/>of<sp/>shape<sp/>`(batch,<sp/>channels,<sp/>height,<sp/>width)`<sp/>if<sp/>`dim_ordering<sp/>=<sp/>&apos;th&apos;`</highlight></codeline>
<codeline lineno="52"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>or<sp/>`(batch,<sp/>height,<sp/>width,<sp/>channels)`<sp/>if<sp/>`dim_ordering<sp/>=<sp/>&apos;tf&apos;`.</highlight></codeline>
<codeline lineno="53"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="54"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Output<sp/>shape:</highlight></codeline>
<codeline lineno="55"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>5D<sp/>tensor<sp/>of<sp/>shape<sp/>`(batch,<sp/>height,<sp/>width,<sp/>n_boxes,<sp/>8)`.<sp/>The<sp/>last<sp/>axis<sp/>contains</highlight></codeline>
<codeline lineno="56"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>four<sp/>anchor<sp/>box<sp/>coordinates<sp/>and<sp/>the<sp/>four<sp/>variance<sp/>values<sp/>for<sp/>each<sp/>box.</highlight></codeline>
<codeline lineno="57"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&apos;&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae01d3b3883a59f2d3b0590d4bdba82d8" kindref="member">__init__</ref>(self,</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>img_height,</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>img_width,</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this_scale,</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>next_scale,</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aspect_ratios=[0.5,<sp/>1.0,<sp/>2.0],</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>two_boxes_for_ar1=True,</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this_steps=None,</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this_offsets=None,</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>clip_boxes=False,</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>variances=[0.1,<sp/>0.1,<sp/>0.2,<sp/>0.2],</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coords=&apos;centroids&apos;,</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>normalize_coords=False,</highlight></codeline>
<codeline lineno="72" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae01d3b3883a59f2d3b0590d4bdba82d8" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>**kwargs):</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&apos;&apos;</highlight></codeline>
<codeline lineno="74"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>All<sp/>arguments<sp/>need<sp/>to<sp/>be<sp/>set<sp/>to<sp/>the<sp/>same<sp/>values<sp/>as<sp/>in<sp/>the<sp/>box<sp/>encoding<sp/>process,<sp/>otherwise<sp/>the<sp/>behavior<sp/>is<sp/>undefined.</highlight></codeline>
<codeline lineno="75"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Some<sp/>of<sp/>these<sp/>arguments<sp/>are<sp/>explained<sp/>in<sp/>more<sp/>detail<sp/>in<sp/>the<sp/>documentation<sp/>of<sp/>the<sp/>`SSDBoxEncoder`<sp/>class.</highlight></codeline>
<codeline lineno="76"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="77"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Arguments:</highlight></codeline>
<codeline lineno="78"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>img_height<sp/>(int):<sp/>The<sp/>height<sp/>of<sp/>the<sp/>input<sp/>images.</highlight></codeline>
<codeline lineno="79"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>img_width<sp/>(int):<sp/>The<sp/>width<sp/>of<sp/>the<sp/>input<sp/>images.</highlight></codeline>
<codeline lineno="80"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this_scale<sp/>(float):<sp/>A<sp/>float<sp/>in<sp/>[0,<sp/>1],<sp/>the<sp/>scaling<sp/>factor<sp/>for<sp/>the<sp/>size<sp/>of<sp/>the<sp/>generated<sp/>anchor<sp/>boxes</highlight></codeline>
<codeline lineno="81"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>a<sp/>fraction<sp/>of<sp/>the<sp/>shorter<sp/>side<sp/>of<sp/>the<sp/>input<sp/>image.</highlight></codeline>
<codeline lineno="82"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>next_scale<sp/>(float):<sp/>A<sp/>float<sp/>in<sp/>[0,<sp/>1],<sp/>the<sp/>next<sp/>larger<sp/>scaling<sp/>factor.<sp/>Only<sp/>relevant<sp/>if</highlight></codeline>
<codeline lineno="83"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>`self.two_boxes_for_ar1<sp/>==<sp/>True`.</highlight></codeline>
<codeline lineno="84"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aspect_ratios<sp/>(list,<sp/>optional):<sp/>The<sp/>list<sp/>of<sp/>aspect<sp/>ratios<sp/>for<sp/>which<sp/>default<sp/>boxes<sp/>are<sp/>to<sp/>be</highlight></codeline>
<codeline lineno="85"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>generated<sp/>for<sp/>this<sp/>layer.</highlight></codeline>
<codeline lineno="86"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>two_boxes_for_ar1<sp/>(bool,<sp/>optional):<sp/>Only<sp/>relevant<sp/>if<sp/>`aspect_ratios`<sp/>contains<sp/>1.</highlight></codeline>
<codeline lineno="87"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>If<sp/>`True`,<sp/>two<sp/>default<sp/>boxes<sp/>will<sp/>be<sp/>generated<sp/>for<sp/>aspect<sp/>ratio<sp/>1.<sp/>The<sp/>first<sp/>will<sp/>be<sp/>generated</highlight></codeline>
<codeline lineno="88"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>using<sp/>the<sp/>scaling<sp/>factor<sp/>for<sp/>the<sp/>respective<sp/>layer,<sp/>the<sp/>second<sp/>one<sp/>will<sp/>be<sp/>generated<sp/>using</highlight></codeline>
<codeline lineno="89"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>geometric<sp/>mean<sp/>of<sp/>said<sp/>scaling<sp/>factor<sp/>and<sp/>next<sp/>bigger<sp/>scaling<sp/>factor.</highlight></codeline>
<codeline lineno="90"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>clip_boxes<sp/>(bool,<sp/>optional):<sp/>If<sp/>`True`,<sp/>clips<sp/>the<sp/>anchor<sp/>box<sp/>coordinates<sp/>to<sp/>stay<sp/>within<sp/>image<sp/>boundaries.</highlight></codeline>
<codeline lineno="91"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>variances<sp/>(list,<sp/>optional):<sp/>A<sp/>list<sp/>of<sp/>4<sp/>floats<sp/>&gt;0.<sp/>The<sp/>anchor<sp/>box<sp/>offset<sp/>for<sp/>each<sp/>coordinate<sp/>will<sp/>be<sp/>divided<sp/>by</highlight></codeline>
<codeline lineno="92"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>its<sp/>respective<sp/>variance<sp/>value.</highlight></codeline>
<codeline lineno="93"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coords<sp/>(str,<sp/>optional):<sp/>The<sp/>box<sp/>coordinate<sp/>format<sp/>to<sp/>be<sp/>used<sp/>internally<sp/>in<sp/>the<sp/>model<sp/>(i.e.<sp/>this<sp/>is<sp/>not<sp/>the<sp/>input<sp/>format</highlight></codeline>
<codeline lineno="94"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>of<sp/>the<sp/>ground<sp/>truth<sp/>labels).<sp/>Can<sp/>be<sp/>either<sp/>&apos;centroids&apos;<sp/>for<sp/>the<sp/>format<sp/>`(cx,<sp/>cy,<sp/>w,<sp/>h)`<sp/>(box<sp/>center<sp/>coordinates,<sp/>width,<sp/>and<sp/>height),</highlight></codeline>
<codeline lineno="95"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;corners&apos;<sp/>for<sp/>the<sp/>format<sp/>`(xmin,<sp/>ymin,<sp/>xmax,<sp/><sp/>ymax)`,<sp/>or<sp/>&apos;minmax&apos;<sp/>for<sp/>the<sp/>format<sp/>`(xmin,<sp/>xmax,<sp/>ymin,<sp/>ymax)`.</highlight></codeline>
<codeline lineno="96"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>normalize_coords<sp/>(bool,<sp/>optional):<sp/>Set<sp/>to<sp/>`True`<sp/>if<sp/>the<sp/>model<sp/>uses<sp/>relative<sp/>instead<sp/>of<sp/>absolute<sp/>coordinates,</highlight></codeline>
<codeline lineno="97"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i.e.<sp/>if<sp/>the<sp/>model<sp/>predicts<sp/>box<sp/>coordinates<sp/>within<sp/>[0,1]<sp/>instead<sp/>of<sp/>absolute<sp/>coordinates.</highlight></codeline>
<codeline lineno="98"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>K.backend()<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;tensorflow&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>TypeError(</highlight><highlight class="stringliteral">&quot;This<sp/>layer<sp/>only<sp/>supports<sp/>TensorFlow<sp/>at<sp/>the<sp/>moment,<sp/>but<sp/>you<sp/>are<sp/>using<sp/>the<sp/>{}<sp/>backend.&quot;</highlight><highlight class="normal">.format(K.backend()))</highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this_scale<sp/>&lt;<sp/>0)<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>(next_scale<sp/>&lt;<sp/>0)<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>(this_scale<sp/>&gt;<sp/>1):</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;`this_scale`<sp/>must<sp/>be<sp/>in<sp/>[0,<sp/>1]<sp/>and<sp/>`next_scale`<sp/>must<sp/>be<sp/>&gt;0,<sp/>but<sp/>`this_scale`<sp/>==<sp/>{},<sp/>`next_scale`<sp/>==<sp/>{}&quot;</highlight><highlight class="normal">.format(this_scale,<sp/>next_scale))</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(variances)<sp/>!=<sp/>4:</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;4<sp/>variance<sp/>values<sp/>must<sp/>be<sp/>pased,<sp/>but<sp/>{}<sp/>values<sp/>were<sp/>received.&quot;</highlight><highlight class="normal">.format(len(variances)))</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>variances<sp/>=<sp/>np.array(variances)</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>np.any(variances<sp/>&lt;=<sp/>0):</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;All<sp/>variances<sp/>must<sp/>be<sp/>&gt;0,<sp/>but<sp/>the<sp/>variances<sp/>given<sp/>are<sp/>{}&quot;</highlight><highlight class="normal">.format(variances))</highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="111" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a2f760ca34099ac8be9e8869362f95295" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a2f760ca34099ac8be9e8869362f95295" kindref="member">img_height</ref><sp/>=<sp/>img_height</highlight></codeline>
<codeline lineno="112" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1e80e372b9345dfd2792b038ee496de9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1e80e372b9345dfd2792b038ee496de9" kindref="member">img_width</ref><sp/>=<sp/>img_width</highlight></codeline>
<codeline lineno="113" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a24e9592f65b944f9d50aeb820b67016c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a24e9592f65b944f9d50aeb820b67016c" kindref="member">this_scale</ref><sp/>=<sp/>this_scale</highlight></codeline>
<codeline lineno="114" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae6c10587c354db5c2104b7c18020c001" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae6c10587c354db5c2104b7c18020c001" kindref="member">next_scale</ref><sp/>=<sp/>next_scale</highlight></codeline>
<codeline lineno="115" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1adf34e7e35d60dd85a2badcb8e0ce9f07" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1adf34e7e35d60dd85a2badcb8e0ce9f07" kindref="member">aspect_ratios</ref><sp/>=<sp/>aspect_ratios</highlight></codeline>
<codeline lineno="116" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1c1bd98352cf19dd0ad2d3e573fe06ab" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1c1bd98352cf19dd0ad2d3e573fe06ab" kindref="member">two_boxes_for_ar1</ref><sp/>=<sp/>two_boxes_for_ar1</highlight></codeline>
<codeline lineno="117" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a31bea1902b9bad5c14ad74c975586a1f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a31bea1902b9bad5c14ad74c975586a1f" kindref="member">this_steps</ref><sp/>=<sp/>this_steps</highlight></codeline>
<codeline lineno="118" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a0f61985b5286284949ebb7849252c3ae" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a0f61985b5286284949ebb7849252c3ae" kindref="member">this_offsets</ref><sp/>=<sp/>this_offsets</highlight></codeline>
<codeline lineno="119" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a156d64fac26c39b4029b7a1063377853" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a156d64fac26c39b4029b7a1063377853" kindref="member">clip_boxes</ref><sp/>=<sp/>clip_boxes</highlight></codeline>
<codeline lineno="120" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a97efbea33013e4f346616123a6c02f9b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a97efbea33013e4f346616123a6c02f9b" kindref="member">variances</ref><sp/>=<sp/>variances</highlight></codeline>
<codeline lineno="121" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a5aa6cd27c22879f898243f55a833d21a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a5aa6cd27c22879f898243f55a833d21a" kindref="member">coords</ref><sp/>=<sp/>coords</highlight></codeline>
<codeline lineno="122" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a3c2c020df03cacc182a84c96140b3e95" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a3c2c020df03cacc182a84c96140b3e95" kindref="member">normalize_coords</ref><sp/>=<sp/>normalize_coords</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Compute<sp/>the<sp/>number<sp/>of<sp/>boxes<sp/>per<sp/>cell</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(1<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>aspect_ratios)<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>two_boxes_for_ar1:</highlight></codeline>
<codeline lineno="125" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae3b69cf6b4d2f0e425ede0d2aac30821" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae3b69cf6b4d2f0e425ede0d2aac30821" kindref="member">n_boxes</ref><sp/>=<sp/>len(aspect_ratios)<sp/>+<sp/>1</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae3b69cf6b4d2f0e425ede0d2aac30821" kindref="member">n_boxes</ref><sp/>=<sp/>len(aspect_ratios)</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>super(AnchorBoxes,<sp/>self).<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae01d3b3883a59f2d3b0590d4bdba82d8" kindref="member">__init__</ref>(**kwargs)</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1aae79e1e24e095100c895e09468e79a43" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1aae79e1e24e095100c895e09468e79a43" kindref="member">build</ref>(self,<sp/>input_shape):</highlight></codeline>
<codeline lineno="131" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a3eb44050c7a18448b40651c143ce3e58" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a3eb44050c7a18448b40651c143ce3e58" kindref="member">input_spec</ref><sp/>=<sp/>[InputSpec(shape=input_shape)]</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>super(AnchorBoxes,<sp/>self).<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1aae79e1e24e095100c895e09468e79a43" kindref="member">build</ref>(input_shape)</highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight></codeline>
<codeline lineno="134" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1aeaccaf4a41fe48f6f5e80431f0456304" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1aeaccaf4a41fe48f6f5e80431f0456304" kindref="member">call</ref>(self,<sp/>x,<sp/>mask=None):</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&apos;&apos;</highlight></codeline>
<codeline lineno="136"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Return<sp/>an<sp/>anchor<sp/>box<sp/>tensor<sp/>based<sp/>on<sp/>the<sp/>shape<sp/>of<sp/>the<sp/>input<sp/>tensor.</highlight></codeline>
<codeline lineno="137"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="138"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>The<sp/>logic<sp/>implemented<sp/>here<sp/>is<sp/>identical<sp/>to<sp/>the<sp/>logic<sp/>in<sp/>the<sp/>module<sp/>`ssd_box_encode_decode_utils.py`.</highlight></codeline>
<codeline lineno="139"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="140"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Note<sp/>that<sp/>this<sp/>tensor<sp/>does<sp/>not<sp/>participate<sp/>in<sp/>any<sp/>graph<sp/>computations<sp/>at<sp/>runtime.<sp/>It<sp/>is<sp/>being<sp/>created</highlight></codeline>
<codeline lineno="141"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>a<sp/>constant<sp/>once<sp/>during<sp/>graph<sp/>creation<sp/>and<sp/>is<sp/>just<sp/>being<sp/>output<sp/>along<sp/>with<sp/>the<sp/>rest<sp/>of<sp/>the<sp/>model<sp/>output</highlight></codeline>
<codeline lineno="142"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>during<sp/>runtime.<sp/>Because<sp/>of<sp/>this,<sp/>all<sp/>logic<sp/>is<sp/>implemented<sp/>as<sp/>Numpy<sp/>array<sp/>operations<sp/>and<sp/>it<sp/>is<sp/>sufficient</highlight></codeline>
<codeline lineno="143"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>to<sp/>convert<sp/>the<sp/>resulting<sp/>Numpy<sp/>array<sp/>into<sp/>a<sp/>Keras<sp/>tensor<sp/>at<sp/>the<sp/>very<sp/>end<sp/>before<sp/>outputting<sp/>it.</highlight></codeline>
<codeline lineno="144"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="145"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Arguments:</highlight></codeline>
<codeline lineno="146"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x<sp/>(tensor):<sp/>4D<sp/>tensor<sp/>of<sp/>shape<sp/>`(batch,<sp/>channels,<sp/>height,<sp/>width)`<sp/>if<sp/>`dim_ordering<sp/>=<sp/>&apos;th&apos;`</highlight></codeline>
<codeline lineno="147"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>or<sp/>`(batch,<sp/>height,<sp/>width,<sp/>channels)`<sp/>if<sp/>`dim_ordering<sp/>=<sp/>&apos;tf&apos;`.<sp/>The<sp/>input<sp/>for<sp/>this</highlight></codeline>
<codeline lineno="148"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>layer<sp/>must<sp/>be<sp/>the<sp/>output<sp/>of<sp/>the<sp/>localization<sp/>predictor<sp/>layer.</highlight></codeline>
<codeline lineno="149"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Compute<sp/>box<sp/>width<sp/>and<sp/>height<sp/>for<sp/>each<sp/>aspect<sp/>ratio</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>The<sp/>shorter<sp/>side<sp/>of<sp/>the<sp/>image<sp/>will<sp/>be<sp/>used<sp/>to<sp/>compute<sp/>`w`<sp/>and<sp/>`h`<sp/>using<sp/>`scale`<sp/>and<sp/>`aspect_ratios`.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>size<sp/>=<sp/>min(self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a2f760ca34099ac8be9e8869362f95295" kindref="member">img_height</ref>,<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1e80e372b9345dfd2792b038ee496de9" kindref="member">img_width</ref>)</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Compute<sp/>the<sp/>box<sp/>widths<sp/>and<sp/>and<sp/>heights<sp/>for<sp/>all<sp/>aspect<sp/>ratios</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wh_list<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>ar<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1adf34e7e35d60dd85a2badcb8e0ce9f07" kindref="member">aspect_ratios</ref>:</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ar<sp/>==<sp/>1):</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Compute<sp/>the<sp/>regular<sp/>anchor<sp/>box<sp/>for<sp/>aspect<sp/>ratio<sp/>1.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>box_height<sp/>=<sp/>box_width<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a24e9592f65b944f9d50aeb820b67016c" kindref="member">this_scale</ref><sp/>*<sp/>size</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wh_list.append((box_width,<sp/>box_height))</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1c1bd98352cf19dd0ad2d3e573fe06ab" kindref="member">two_boxes_for_ar1</ref>:</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Compute<sp/>one<sp/>slightly<sp/>larger<sp/>version<sp/>using<sp/>the<sp/>geometric<sp/>mean<sp/>of<sp/>this<sp/>scale<sp/>value<sp/>and<sp/>the<sp/>next.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>box_height<sp/>=<sp/>box_width<sp/>=<sp/>np.sqrt(self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a24e9592f65b944f9d50aeb820b67016c" kindref="member">this_scale</ref><sp/>*<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae6c10587c354db5c2104b7c18020c001" kindref="member">next_scale</ref>)<sp/>*<sp/>size</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wh_list.append((box_width,<sp/>box_height))</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>box_height<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a24e9592f65b944f9d50aeb820b67016c" kindref="member">this_scale</ref><sp/>*<sp/>size<sp/>/<sp/>np.sqrt(ar)</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>box_width<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a24e9592f65b944f9d50aeb820b67016c" kindref="member">this_scale</ref><sp/>*<sp/>size<sp/>*<sp/>np.sqrt(ar)</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wh_list.append((box_width,<sp/>box_height))</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wh_list<sp/>=<sp/>np.array(wh_list)</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>We<sp/>need<sp/>the<sp/>shape<sp/>of<sp/>the<sp/>input<sp/>tensor</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>K.image_dim_ordering()<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;tf&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>batch_size,<sp/>feature_map_height,<sp/>feature_map_width,<sp/>feature_map_channels<sp/>=<sp/>x._keras_shape</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:<sp/></highlight><highlight class="comment">#<sp/>Not<sp/>yet<sp/>relevant<sp/>since<sp/>TensorFlow<sp/>is<sp/>the<sp/>only<sp/>supported<sp/>backend<sp/>right<sp/>now,<sp/>but<sp/>it<sp/>can&apos;t<sp/>harm<sp/>to<sp/>have<sp/>this<sp/>in<sp/>here<sp/>for<sp/>the<sp/>future</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>batch_size,<sp/>feature_map_channels,<sp/>feature_map_height,<sp/>feature_map_width<sp/>=<sp/>x._keras_shape</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Compute<sp/>the<sp/>grid<sp/>of<sp/>box<sp/>center<sp/>points.<sp/>They<sp/>are<sp/>identical<sp/>for<sp/>all<sp/>aspect<sp/>ratios.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Compute<sp/>the<sp/>step<sp/>sizes,<sp/>i.e.<sp/>how<sp/>far<sp/>apart<sp/>the<sp/>anchor<sp/>box<sp/>center<sp/>points<sp/>will<sp/>be<sp/>vertically<sp/>and<sp/>horizontally.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a31bea1902b9bad5c14ad74c975586a1f" kindref="member">this_steps</ref><sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>step_height<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a2f760ca34099ac8be9e8869362f95295" kindref="member">img_height</ref><sp/>/<sp/>feature_map_height</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>step_width<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1e80e372b9345dfd2792b038ee496de9" kindref="member">img_width</ref><sp/>/<sp/>feature_map_width</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>isinstance(self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a31bea1902b9bad5c14ad74c975586a1f" kindref="member">this_steps</ref>,<sp/>(list,<sp/>tuple))<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>(len(self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a31bea1902b9bad5c14ad74c975586a1f" kindref="member">this_steps</ref>)<sp/>==<sp/>2):</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>step_height<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a31bea1902b9bad5c14ad74c975586a1f" kindref="member">this_steps</ref>[0]</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>step_width<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a31bea1902b9bad5c14ad74c975586a1f" kindref="member">this_steps</ref>[1]</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>isinstance(self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a31bea1902b9bad5c14ad74c975586a1f" kindref="member">this_steps</ref>,<sp/>(int,<sp/>float)):</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>step_height<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a31bea1902b9bad5c14ad74c975586a1f" kindref="member">this_steps</ref></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>step_width<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a31bea1902b9bad5c14ad74c975586a1f" kindref="member">this_steps</ref></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Compute<sp/>the<sp/>offsets,<sp/>i.e.<sp/>at<sp/>what<sp/>pixel<sp/>values<sp/>the<sp/>first<sp/>anchor<sp/>box<sp/>center<sp/>point<sp/>will<sp/>be<sp/>from<sp/>the<sp/>top<sp/>and<sp/>from<sp/>the<sp/>left<sp/>of<sp/>the<sp/>image.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a0f61985b5286284949ebb7849252c3ae" kindref="member">this_offsets</ref><sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offset_height<sp/>=<sp/>0.5</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offset_width<sp/>=<sp/>0.5</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>isinstance(self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a0f61985b5286284949ebb7849252c3ae" kindref="member">this_offsets</ref>,<sp/>(list,<sp/>tuple))<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>(len(self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a0f61985b5286284949ebb7849252c3ae" kindref="member">this_offsets</ref>)<sp/>==<sp/>2):</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offset_height<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a0f61985b5286284949ebb7849252c3ae" kindref="member">this_offsets</ref>[0]</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offset_width<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a0f61985b5286284949ebb7849252c3ae" kindref="member">this_offsets</ref>[1]</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>isinstance(self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a0f61985b5286284949ebb7849252c3ae" kindref="member">this_offsets</ref>,<sp/>(int,<sp/>float)):</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offset_height<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a0f61985b5286284949ebb7849252c3ae" kindref="member">this_offsets</ref></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offset_width<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a0f61985b5286284949ebb7849252c3ae" kindref="member">this_offsets</ref></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Now<sp/>that<sp/>we<sp/>have<sp/>the<sp/>offsets<sp/>and<sp/>step<sp/>sizes,<sp/>compute<sp/>the<sp/>grid<sp/>of<sp/>anchor<sp/>box<sp/>center<sp/>points.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cy<sp/>=<sp/>np.linspace(offset_height<sp/>*<sp/>step_height,<sp/>(offset_height<sp/>+<sp/>feature_map_height<sp/>-<sp/>1)<sp/>*<sp/>step_height,<sp/>feature_map_height)</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cx<sp/>=<sp/>np.linspace(offset_width<sp/>*<sp/>step_width,<sp/>(offset_width<sp/>+<sp/>feature_map_width<sp/>-<sp/>1)<sp/>*<sp/>step_width,<sp/>feature_map_width)</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cx_grid,<sp/>cy_grid<sp/>=<sp/>np.meshgrid(cx,<sp/>cy)</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cx_grid<sp/>=<sp/>np.expand_dims(cx_grid,<sp/>-1)<sp/></highlight><highlight class="comment">#<sp/>This<sp/>is<sp/>necessary<sp/>for<sp/>np.tile()<sp/>to<sp/>do<sp/>what<sp/>we<sp/>want<sp/>further<sp/>down</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cy_grid<sp/>=<sp/>np.expand_dims(cy_grid,<sp/>-1)<sp/></highlight><highlight class="comment">#<sp/>This<sp/>is<sp/>necessary<sp/>for<sp/>np.tile()<sp/>to<sp/>do<sp/>what<sp/>we<sp/>want<sp/>further<sp/>down</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Create<sp/>a<sp/>4D<sp/>tensor<sp/>template<sp/>of<sp/>shape<sp/>`(feature_map_height,<sp/>feature_map_width,<sp/>n_boxes,<sp/>4)`</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>where<sp/>the<sp/>last<sp/>dimension<sp/>will<sp/>contain<sp/>`(cx,<sp/>cy,<sp/>w,<sp/>h)`</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor<sp/>=<sp/>np.zeros((feature_map_height,<sp/>feature_map_width,<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae3b69cf6b4d2f0e425ede0d2aac30821" kindref="member">n_boxes</ref>,<sp/>4))</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor[:,<sp/>:,<sp/>:,<sp/>0]<sp/>=<sp/>np.tile(cx_grid,<sp/>(1,<sp/>1,<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae3b69cf6b4d2f0e425ede0d2aac30821" kindref="member">n_boxes</ref>))<sp/></highlight><highlight class="comment">#<sp/>Set<sp/>cx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor[:,<sp/>:,<sp/>:,<sp/>1]<sp/>=<sp/>np.tile(cy_grid,<sp/>(1,<sp/>1,<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae3b69cf6b4d2f0e425ede0d2aac30821" kindref="member">n_boxes</ref>))<sp/></highlight><highlight class="comment">#<sp/>Set<sp/>cy</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor[:,<sp/>:,<sp/>:,<sp/>2]<sp/>=<sp/>wh_list[:,<sp/>0]<sp/></highlight><highlight class="comment">#<sp/>Set<sp/>w</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor[:,<sp/>:,<sp/>:,<sp/>3]<sp/>=<sp/>wh_list[:,<sp/>1]<sp/></highlight><highlight class="comment">#<sp/>Set<sp/>h</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Convert<sp/>`(cx,<sp/>cy,<sp/>w,<sp/>h)`<sp/>to<sp/>`(xmin,<sp/>xmax,<sp/>ymin,<sp/>ymax)`</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor<sp/>=<sp/><ref refid="namespacekeras__utils_1_1bounding__box__utils_1a7b2a9d86d4acfcddcec55133486f2012" kindref="member">convert_coordinates</ref>(boxes_tensor,<sp/>start_index=0,<sp/>conversion=</highlight><highlight class="stringliteral">&apos;centroids2corners&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>If<sp/>`clip_boxes`<sp/>is<sp/>enabled,<sp/>clip<sp/>the<sp/>coordinates<sp/>to<sp/>lie<sp/>within<sp/>the<sp/>image<sp/>boundaries</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a156d64fac26c39b4029b7a1063377853" kindref="member">clip_boxes</ref>:</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x_coords<sp/>=<sp/>boxes_tensor[:,:,:,[0,<sp/>2]]</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x_coords[x_coords<sp/>&gt;=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1e80e372b9345dfd2792b038ee496de9" kindref="member">img_width</ref>]<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1e80e372b9345dfd2792b038ee496de9" kindref="member">img_width</ref><sp/>-<sp/>1</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x_coords[x_coords<sp/>&lt;<sp/>0]<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor[:,:,:,[0,<sp/>2]]<sp/>=<sp/>x_coords</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>y_coords<sp/>=<sp/>boxes_tensor[:,:,:,[1,<sp/>3]]</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>y_coords[y_coords<sp/>&gt;=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a2f760ca34099ac8be9e8869362f95295" kindref="member">img_height</ref>]<sp/>=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a2f760ca34099ac8be9e8869362f95295" kindref="member">img_height</ref><sp/>-<sp/>1</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>y_coords[y_coords<sp/>&lt;<sp/>0]<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor[:,:,:,[1,<sp/>3]]<sp/>=<sp/>y_coords</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>If<sp/>`normalize_coords`<sp/>is<sp/>enabled,<sp/>normalize<sp/>the<sp/>coordinates<sp/>to<sp/>be<sp/>within<sp/>[0,1]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a3c2c020df03cacc182a84c96140b3e95" kindref="member">normalize_coords</ref>:</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor[:,<sp/>:,<sp/>:,<sp/>[0,<sp/>2]]<sp/>/=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1e80e372b9345dfd2792b038ee496de9" kindref="member">img_width</ref></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor[:,<sp/>:,<sp/>:,<sp/>[1,<sp/>3]]<sp/>/=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a2f760ca34099ac8be9e8869362f95295" kindref="member">img_height</ref></highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>TODO:<sp/>Implement<sp/>box<sp/>limiting<sp/>directly<sp/>for<sp/>`(cx,<sp/>cy,<sp/>w,<sp/>h)`<sp/>so<sp/>that<sp/>we<sp/>don&apos;t<sp/>have<sp/>to<sp/>unnecessarily<sp/>convert<sp/>back<sp/>and<sp/>forth.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a5aa6cd27c22879f898243f55a833d21a" kindref="member">coords</ref><sp/>==<sp/></highlight><highlight class="stringliteral">&apos;centroids&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Convert<sp/>`(xmin,<sp/>ymin,<sp/>xmax,<sp/>ymax)`<sp/>back<sp/>to<sp/>`(cx,<sp/>cy,<sp/>w,<sp/>h)`.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor<sp/>=<sp/><ref refid="namespacekeras__utils_1_1bounding__box__utils_1a7b2a9d86d4acfcddcec55133486f2012" kindref="member">convert_coordinates</ref>(boxes_tensor,<sp/>start_index=0,<sp/>conversion=</highlight><highlight class="stringliteral">&apos;corners2centroids&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a5aa6cd27c22879f898243f55a833d21a" kindref="member">coords</ref><sp/>==<sp/></highlight><highlight class="stringliteral">&apos;minmax&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Convert<sp/>`(xmin,<sp/>ymin,<sp/>xmax,<sp/>ymax)`<sp/>to<sp/>`(xmin,<sp/>xmax,<sp/>ymin,<sp/>ymax).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor<sp/>=<sp/><ref refid="namespacekeras__utils_1_1bounding__box__utils_1a7b2a9d86d4acfcddcec55133486f2012" kindref="member">convert_coordinates</ref>(boxes_tensor,<sp/>start_index=0,<sp/>conversion=</highlight><highlight class="stringliteral">&apos;corners2minmax&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Create<sp/>a<sp/>tensor<sp/>to<sp/>contain<sp/>the<sp/>variances<sp/>and<sp/>append<sp/>it<sp/>to<sp/>`boxes_tensor`.<sp/>This<sp/>tensor<sp/>has<sp/>the<sp/>same<sp/>shape</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>as<sp/>`boxes_tensor`<sp/>and<sp/>simply<sp/>contains<sp/>the<sp/>same<sp/>4<sp/>variance<sp/>values<sp/>for<sp/>every<sp/>position<sp/>in<sp/>the<sp/>last<sp/>axis.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>variances_tensor<sp/>=<sp/>np.zeros_like(boxes_tensor)<sp/></highlight><highlight class="comment">#<sp/>Has<sp/>shape<sp/>`(feature_map_height,<sp/>feature_map_width,<sp/>n_boxes,<sp/>4)`</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>variances_tensor<sp/>+=<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a97efbea33013e4f346616123a6c02f9b" kindref="member">variances</ref><sp/></highlight><highlight class="comment">#<sp/>Long<sp/>live<sp/>broadcasting</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Now<sp/>`boxes_tensor`<sp/>becomes<sp/>a<sp/>tensor<sp/>of<sp/>shape<sp/>`(feature_map_height,<sp/>feature_map_width,<sp/>n_boxes,<sp/>8)`</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor<sp/>=<sp/>np.concatenate((boxes_tensor,<sp/>variances_tensor),<sp/>axis=-1)</highlight></codeline>
<codeline lineno="250"><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Now<sp/>prepend<sp/>one<sp/>dimension<sp/>to<sp/>`boxes_tensor`<sp/>to<sp/>account<sp/>for<sp/>the<sp/>batch<sp/>size<sp/>and<sp/>tile<sp/>it<sp/>along</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>The<sp/>result<sp/>will<sp/>be<sp/>a<sp/>5D<sp/>tensor<sp/>of<sp/>shape<sp/>`(batch_size,<sp/>feature_map_height,<sp/>feature_map_width,<sp/>n_boxes,<sp/>8)`</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor<sp/>=<sp/>np.expand_dims(boxes_tensor,<sp/>axis=0)</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boxes_tensor<sp/>=<sp/>K.tile(K.constant(boxes_tensor,<sp/>dtype=</highlight><highlight class="stringliteral">&apos;float32&apos;</highlight><highlight class="normal">),<sp/>(K.shape(x)[0],<sp/>1,<sp/>1,<sp/>1,<sp/>1))</highlight></codeline>
<codeline lineno="255"><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>boxes_tensor</highlight></codeline>
<codeline lineno="257"><highlight class="normal"></highlight></codeline>
<codeline lineno="258" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1aac014e7b48a6d681b225db3341ce7198" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1aac014e7b48a6d681b225db3341ce7198" kindref="member">compute_output_shape</ref>(self,<sp/>input_shape):</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>K.image_dim_ordering()<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;tf&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>batch_size,<sp/>feature_map_height,<sp/>feature_map_width,<sp/>feature_map_channels<sp/>=<sp/>input_shape</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:<sp/></highlight><highlight class="comment">#<sp/>Not<sp/>yet<sp/>relevant<sp/>since<sp/>TensorFlow<sp/>is<sp/>the<sp/>only<sp/>supported<sp/>backend<sp/>right<sp/>now,<sp/>but<sp/>it<sp/>can&apos;t<sp/>harm<sp/>to<sp/>have<sp/>this<sp/>in<sp/>here<sp/>for<sp/>the<sp/>future</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>batch_size,<sp/>feature_map_channels,<sp/>feature_map_height,<sp/>feature_map_width<sp/>=<sp/>input_shape</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(batch_size,<sp/>feature_map_height,<sp/>feature_map_width,<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae3b69cf6b4d2f0e425ede0d2aac30821" kindref="member">n_boxes</ref>,<sp/>8)</highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight></codeline>
<codeline lineno="265" refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1988375ec7920e139beb249a8151bba2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1988375ec7920e139beb249a8151bba2" kindref="member">get_config</ref>(self):</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;img_height&apos;</highlight><highlight class="normal">:<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a2f760ca34099ac8be9e8869362f95295" kindref="member">img_height</ref>,</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;img_width&apos;</highlight><highlight class="normal">:<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1e80e372b9345dfd2792b038ee496de9" kindref="member">img_width</ref>,</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;this_scale&apos;</highlight><highlight class="normal">:<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a24e9592f65b944f9d50aeb820b67016c" kindref="member">this_scale</ref>,</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;next_scale&apos;</highlight><highlight class="normal">:<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1ae6c10587c354db5c2104b7c18020c001" kindref="member">next_scale</ref>,</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;aspect_ratios&apos;</highlight><highlight class="normal">:<sp/>list(self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1adf34e7e35d60dd85a2badcb8e0ce9f07" kindref="member">aspect_ratios</ref>),</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;two_boxes_for_ar1&apos;</highlight><highlight class="normal">:<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1c1bd98352cf19dd0ad2d3e573fe06ab" kindref="member">two_boxes_for_ar1</ref>,</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;clip_boxes&apos;</highlight><highlight class="normal">:<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a156d64fac26c39b4029b7a1063377853" kindref="member">clip_boxes</ref>,</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;variances&apos;</highlight><highlight class="normal">:<sp/>list(self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a97efbea33013e4f346616123a6c02f9b" kindref="member">variances</ref>),</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;coords&apos;</highlight><highlight class="normal">:<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a5aa6cd27c22879f898243f55a833d21a" kindref="member">coords</ref>,</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;normalize_coords&apos;</highlight><highlight class="normal">:<sp/>self.<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a3c2c020df03cacc182a84c96140b3e95" kindref="member">normalize_coords</ref></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>base_config<sp/>=<sp/>super(AnchorBoxes,<sp/>self).<ref refid="classkeras__utils_1_1keras__layer___anchor_boxes_1_1_anchor_boxes_1a1988375ec7920e139beb249a8151bba2" kindref="member">get_config</ref>()</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>dict(list(base_config.items())<sp/>+<sp/>list(config.items()))</highlight></codeline>
    </programlisting>
    <location file="DeepLearningSuite/DeepLearningSuiteLib/python_modules/keras_utils/keras_layer_AnchorBoxes.py"/>
  </compounddef>
</doxygen>
